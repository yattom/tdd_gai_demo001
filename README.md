# 生成AIとTDDでTCGを作るデモ

CC-BY 4.0

Copyright(C)2024 合同会社やっとむ屋、やっとむ <yattom@yattom.jp>

## 解説

- 生成AIとペアプロをする風味で、TDDを実践するデモをやります
- 特に準備をしているわけではないので、どうなるかわかりません
- 時間を60分間とします。10分ごとにふりかえりをしようと思います
- お題は事前に生成しておきました
  - AIに読んでもらえるようREADMEに書いています
- またどんなふうに生成AI、ペアプロ、TDDをしたいと思っているか、下に書いてあります
  - とりあえず考えてみたレベルの内容
  - これもAIが読んでくれることを想定しています
- 日本語の切り替えが不調法なので、英語と混ぜて書くと思います (キーバインドがヘボですみません)
- 言語はPython、テストはpytest、開発環境はIntelliJ IDEA、生成AIはJetBrains AI Assistantです
  - Python 3.13
  - pytest 8.3.3
  - IntelliJ IDEA 2024.3
  - AI Assistant 243.21565.247

## TCGの仕様

プレイヤー同士が1対1で対戦するシンプルなトレーディングカードゲーム(TCG)を実装してください。各プレイヤーは20のライフポイントと、固定の5枚のカードデッキを持ちます。各カードには攻撃力（1～5）が設定されています。ターン制で進行し、プレイヤーはターンごとに1枚のカードを使用して相手にダメージを与えます。ライフが0以下になったプレイヤーが敗北します。デッキのシャッフルや、ターンの管理も行う必要があります。

## テストリスト

- [ ] ゲームの基本構造を作る
  - [ ] 最もシンプルな1ターンの進行を実装する
    - [x] プレイヤー2人が存在する状態を作る
      - [x] Player1とPlayer2がいる
    - [ ] 各プレイヤーが1枚ずつカードを持っている状態で、1ターンを実行できる
      - [x] Player1が攻撃力3のカードを1枚持っている
      - [x] Player1がカードを使用するとPlayer2がダメージを受ける
      - [x] Player2がカードを使用するとPlayer1がダメージを受ける
    - [x] 基本的なゲームの終了判定ができる
      - [x] 敗北して終了する場合
        - [x] Player1がカードを使用するとPlayer2がダメージを受けライフポイントが0になり終了
      - [x] 敗北せず続く場合
        - [x] Player1がカードを使用するとPlayer2がダメージを受けライフポイントが11になり継続
  - [ ] 最小限の完全なゲームを実装する
    - [ ] プレイヤー2人が5枚ずつカードを持った状態でゲームを開始できる
    - [ ] 交互に手番を行い、カードを使用できる
    - [ ] すべてのカードを使い切るまでゲームを進行できる
    - [ ] 勝敗が確定した時点でゲームを終了できる
  - [ ] ゲームの状態を外部から確認できるようにする
    - [ ] 現在のターン数を取得できる
    - [ ] 各プレイヤーの残りライフを確認できる
    - [ ] 各プレイヤーの残りカード枚数を確認できる
    - [ ] ゲームの進行状態（進行中/終了）を確認できる
- [ ] カードの基本実装 （前述の内容を維持）
- [ ] プレイヤーの状態管理 （前述の内容を維持）
- [ ] デッキの管理とシャッフル （前述の内容を維持）
- [ ] ターン制の実装 （前述の内容を維持）

## 生成AIとペアプロでTDDする

人と生成AIがペアプロでTDDするのにあたり、以下の役割分担や、テクニック、やりとりをしながら進めます。

- 仕様を貼り付けてテストリストを作る
  - テストケースではなく、実装を進めるために仕様・機能を取り扱いやす大きさで切り出して並べる
  - 全体を網羅できるようトップレベルの項目を出してから、進める順序に応じて細分化していく
  - トップレベルは、機能分割の場合と、状況や場合で分割する場合があり、適切なアプローチを選ぶ
  - どうなるかわからない箇所、イメージしにくい箇所、リスクがある箇所をできるだけ早く着手する。As Kent Beck put it, "Known to Unknown, One step at a time."
  - 実装するものの全体像をできるだけ早くプログラマーが把握できるように、仕様から最低限の部分を抽出して全体構成を早いタイミングで導く。よくないアプローチの例として、部品を先にすべて作ってから組み合わせる、1機能の仕様を完全に作り上げてから次の機能に進む、網羅的なテストケースを先に作ろうとする、などがある
  - 着手するものは具体的なテストケースにする
  - 各項目は説明的に、内容と意図がわかるように記述し、あまり完結にしない
- テストを書いてレッドにする
  - アサート部分を人が書く。あるいはアサートしたいことをコメントで人が書いてコードをAIに書いてもらう
  - 実行部分に新しい型やメソッドが登場するなら、命名やシグネチャをAIと相談しながら書く
  - 既存のものを呼ぶだけならば、準備と実行部分はAIに任せて人が確認する
  - テストを実行する前に、結果をAIと一緒に予想する
  - 実行して予想と合っているか確認する
- グリーンになるよう実装する
  - 基本的にはAIに書いてもらう
  - テストを実行し、グリーンにならなかったら、AIに情報を渡して直してもらう
  - 簡単に直らないようなら (あるいは人が問題に気づいたら) 人が直接直すか、AIに情報を追加で渡す
- リファクタリング
  - 人がコードを容易に理解できるようなリファクタリングをする。人が直接書いてもいいし、方針をAIに伝えてもいい
  - よりシンプルな構造になるようなテストを追加で書いて、AIのリファクタリングを引き出す
  - テストが多いときは、テストの重複除去や整理ができないか、AIと一緒に検討する
